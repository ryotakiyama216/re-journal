# Re:Journal v2 ブラッシュアップ計画書

## 1. v1の現状分析
v1では「予定の整理」と「具体的な行動アドバイス」という、実用的なアシスタントとしての側面が強く出ました。これは非常に便利ですが、本来の「ジャーナリング（内省・心の整理）」という情緒的な側面をさらに強化する余地があります。

## 2. ブラッシュアップ案（v2）

### 2.1 「日記」から「ジャーナル」への深化
現状は「予定の確認」に近い体験です。これを「自分の心と向き合う」体験へシフトさせます。
- **感情のラベリング**: 予定の実行に対して「どんな気持ちで臨みたいか（ワクワク、不安、淡々と等）」をAIが問いかけ、結果画面で「今日のあなたの心のカラー」を提示。
- **振り返りサイクルの導入**: 
  - **Morning Session**: 今日の予定と準備の整理（現在の機能）。
  - **Evening Session**: 実際にどうだったか、AIが「お疲れ様」と共に振り返りを促す。
- **「余白」の提案**: 予定が詰まりすぎている場合、AIが「この間に15分だけコーヒータイムを入れない？」と、あえて何もしない時間を提案する。

### 2.2 パーソナライズの本格化（Supabase連携）
- **真のユーザープロフィール**: 住所、職種、趣味だけでなく、過去のジャーナルから「ユーザーの性格」や「疲れやすいパターン」をAIが学習。
- **コンテキスト共有**: 「前回の通院はどうだった？」など、過去の対話を踏まえた継続的なコミュニケーション。

### 2.3 UI/UXの洗練
- **フォーカス・タイピング**: 入力中、周りの要素がスッと消え、文字と自分だけが向き合える演出。
- **言語切り替え (i18n)**: 日本語・英語の完全対応。AIの口調も英語圏の親友のようなノリに変化。
- **モバイル最適化**: PWA化により、外出先でもサッと予定を確認・入力できる体験。

### 2.4 データの視覚化（Insights）
- **行動・感情グラフ**: 忙しさと心の充実度の相関をグラフ化。
- **Journey Map**: これまで積み上げてきた「Journey（累計投稿）」を、地図を進んでいくようなビジュアルで表現。

### 2.5 Dify による AI 精度の向上
- **プロンプトエンジニアリングの高度化**: ユーザーの入力意図をより正確に汲み取るため、Few-shot プロンプティングや Chain-of-Thought を導入。
- **RAG (Retrieval-Augmented Generation) の活用**: 過去のジャーナルデータをナレッジベースとして参照し、ユーザーの文脈に沿った一貫性のあるアドバイスを提供。
- **ワークフローの最適化**: Dify のワークフロー機能を活用し、感情分析、予定抽出、アドバイス生成の各ステップを精緻化。

## 3. データベース設計（Supabase / PostgreSQL）
v2でのデータ永続化に向けたテーブル設計案です。

### 3.1 users (ユーザー管理)
Supabase Authと連携し、ユーザーの基本プロフィールを保持します。
- `id`: uuid (Primary Key, Supabase Auth ID)
- `email`: string
- `display_name`: string
- `avatar_url`: string
- `language_preference`: string (default: 'ja')
- `profile_data`: jsonb (住所、職種、趣味、AIへの指示用コンテキスト等)
- `created_at`: timestamp

### 3.2 journals (ジャーナル本体)
日々の投稿データを格納します。
- `id`: uuid (Primary Key)
- `user_id`: uuid (Foreign Key -> users.id)
- `entry_date`: date (投稿対象日)
- `mood_score`: integer (AIが判定した感情スコア)
- `overall_summary`: text (AIによるその日の総評)
- `created_at`: timestamp

### 3.3 journal_plans (予定とAI対話)
1つのジャーナルに紐づく複数の予定と、それに対するAIとの対話履歴を格納します。
- `id`: uuid (Primary Key)
- `journal_id`: uuid (Foreign Key -> journals.id)
- `plan_content`: text (ユーザーが入力した予定)
- `deep_dive_history`: jsonb (AIの質問とユーザーの回答の配列)
- `ai_advice`: text (その予定に対するAIの最終アドバイス)
- `status`: string ('pending', 'completed')
- `order_index`: integer (表示順)

### 3.4 insights (分析データ)
統計情報を高速に取得するための集計テーブル（またはView）。
- `user_id`: uuid
- `total_posts`: integer
- `current_streak`: integer
- `focus_theme`: string (最近の頻出ワードからAIが抽出)

## 4. 実装優先順位
1.  **Supabase連携 & ユーザー認証**: データの永続化とテーブル作成。
2.  **言語変更機能**: グローバル対応。
3.  **振り返り（Evening Session）の実装**: ジャーナリング体験の完結。
4.  **Insights画面のビジュアル化**: 継続のモチベーション向上。
